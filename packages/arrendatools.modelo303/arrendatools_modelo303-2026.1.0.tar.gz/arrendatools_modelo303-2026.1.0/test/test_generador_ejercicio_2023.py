import unittest

from arrendatools.modelo303.datos import Modelo303Datos, Periodo
from arrendatools.modelo303.factory import Modelo303Factory


class GeneradorEjercicio2023TestCase(unittest.TestCase):
    def setUp(self):
        # Datos base v√°lidos
        self.datos_validos = {
            "periodo": Periodo.PRIMER_TRIMESTRE,
            "version": "v1.0",
            "nif_empresa_desarrollo": "12345678X",
            "nombre_fiscal_contribuyente": "DE LOS PALOTES PERICO",
            "nif_contribuyente": "12345678E",
            "base_imponible": 2000.00,
        }

    def test_generar_modelo_123T_cuota_positiva(self):
        expected_result = "<T303020231T0000><AUX>                                                                      v1.0    12345678X                                                                                                                                                                                                                     </AUX><T30301000> U12345678EDE LOS PALOTES PERICO                                                           20231T22322222200000000 20000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000005000000000000000000000000000000000000010000000000000000000000000000000200000021000000000000004200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001750000000000000000000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000005200000000000000000000000000000000000000000000000000000000000000004200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000042000                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     </T30301000><T30303000>0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000420001000000000000000042000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000042000000000000000000000000000000000000000000000000042000                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       </T30303000><T303DID00>           ES0012341234123412341234                                                                                                                                                   0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         </T303DID00></T303020231T0000>"
        self.datos_validos["iban"] = "ES0012341234123412341234"

        datos_modelo = Modelo303Datos(**self.datos_validos)
        modelo = Modelo303Factory.obtener_generador_modelo303(2023)
        datos_fichero = modelo.generar(datos_modelo)
        self.assertEqual(datos_fichero, expected_result)

    def test_generar_modelo_123T_cuota_negativa(self):
        expected_result = "<T303020231T0000><AUX>                                                                      v1.0    12345678X                                                                                                                                                                                                                     </AUX><T30301000> C12345678EDE LOS PALOTES PERICO                                                           20231T22322222200000000 200000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000050000000000000000000000000000000000000100000000000000000000000000000002000000210000000000000042000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000017500000000000000000000000000000000000000000000000000000000000000000000000000014000000000000000000000000000000000000052000000000000000000000000000000000000000000000000000000000000000042000000000000002500000000000000005250000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000052500N0000000000010500                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     </T30301000><T30303000>0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000N000000000001050010000N00000000000105000000000000000000000000000000000000000000000000000000000000000000000000000000000000000N00000000000105000000000000000000000000000000000000N0000000000010500                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       </T30303000><T303DID00>                                                                                                                                                                                      0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         </T303DID00></T303020231T0000>"
        self.datos_validos["iban"] = "ES0012341234123412341234"
        self.datos_validos["gastos_bienes_servicios"] = 2500.0
        self.datos_validos["iva_gastos_bienes_servicios"] = 525.0

        datos_modelo = Modelo303Datos(**self.datos_validos)
        modelo = Modelo303Factory.obtener_generador_modelo303(2023)
        datos_fichero = modelo.generar(datos_modelo)
        self.assertEqual(datos_fichero, expected_result)

    def test_generar_modelo_4T_cuota_positiva(self):
        expected_result = "<T303020234T0000><AUX>                                                                      v1.0    12345678X                                                                                                                                                                                                                     </AUX><T30301000> U12345678EDE LOS PALOTES PERICO                                                           20234T22322222200000000 21100000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000005000000000000000000000000000000000000010000000000000000000000000000000200000021000000000000004200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001750000000000000000000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000005200000000000000000000000000000000000000000000000000000000000000004200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000042000                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     </T30301000><T30303000>0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000420001000000000000000042000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000042000000000000000000000000000000000000000000000000042000                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       </T30303000><T30304000> A018612                                    0000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </T30304000><T30305000>    0000000000000000000000000000000000 00000   0000000000000000000000000000000000 00000   0000000000000000000000000000000000 00000   0000000000000000000000000000000000 00000   0000000000000000000000000000000000 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </T30305000><T303DID00>           ES0012341234123412341234                                                                                                                                                   0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         </T303DID00></T303020234T0000>"
        self.datos_validos["iban"] = "ES0012341234123412341234"
        self.datos_validos["periodo"] = Periodo.CUARTO_TRIMESTRE
        self.datos_validos["volumen_anual_operaciones"] = 6000.0

        datos_modelo = Modelo303Datos(**self.datos_validos)
        modelo = Modelo303Factory.obtener_generador_modelo303(2023)
        datos_fichero = modelo.generar(datos_modelo)
        self.assertEqual(datos_fichero, expected_result)

    def test_generar_modelo_4T_cuota_negativa(self):
        pass

    def test_generar_modelo_sin_iban(self):
        expected_result = "<T303020231T0000><AUX>                                                                      v1.0    12345678X                                                                                                                                                                                                                     </AUX><T30301000> I12345678EDE LOS PALOTES PERICO                                                           20231T22322222200000000 20000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000005000000000000000000000000000000000000010000000000000000000000000000000200000021000000000000004200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001750000000000000000000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000005200000000000000000000000000000000000000000000000000000000000000004200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000042000                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     </T30301000><T30303000>0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000420001000000000000000042000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000042000000000000000000000000000000000000000000000000042000                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       </T30303000><T303DID00>                                                                                                                                                                                      0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         </T303DID00></T303020231T0000>"

        datos_modelo = Modelo303Datos(**self.datos_validos)
        modelo = Modelo303Factory.obtener_generador_modelo303(2023)
        datos_fichero = modelo.generar(datos_modelo)
        self.assertEqual(datos_fichero, expected_result)


if __name__ == "__main__":
    unittest.main()
