<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Display</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-family: Arial, sans-serif;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        tr:hover {
            background-color: #f1f1f1;
        }
    </style>
</head>
<body>
    <h1>Data from API</h1>

    <!-- Dropdowns to select date and index -->
    <label for="dateSelect">Select a date:</label>
    <input type="date" id="dateSelect">

    <label for="indexSelect">Select an index:</label>
    <select id="indexSelect">
        <option value="">--Select an index--</option>
        <option value="Euro Stoxx 50">Euro Stoxx 50</option>
        <option value="S&P 500">S&P 500</option>
    </select>

    <table id="dataTable">
        <thead>
            <tr>
                <th>Strike/Maturity</th>  
            </tr>
        </thead>
        <tbody>
            
        </tbody>
    </table>

    <script>
        // Function to round numbers to a specific number of decimal places
        function roundNumber(num, decimals) {
            return parseFloat(num).toFixed(decimals);
        }

        // Fetch data when both date and index are selected
        document.getElementById('dateSelect').addEventListener('change', fetchData);
        document.getElementById('indexSelect').addEventListener('change', fetchData);

        function fetchData() {
            const selectedDate = document.getElementById('dateSelect').value;
            const selectedIndex = document.getElementById('indexSelect').value;

            if (selectedDate && selectedIndex) {
                fetch(`/api/data?date=${encodeURIComponent(selectedDate)}&index=${encodeURIComponent(selectedIndex)}`)
                    .then(response => response.json())
                    .then(data => {
                        console.log("Data received from API:", data);

                        
                        if (Array.isArray(data) && data.length > 0) {
                            const headers = Object.keys(data[0]);

                            const tableBody = document.getElementById('dataTable').getElementsByTagName('tbody')[0];
                            tableBody.innerHTML = ''; 

                            
                            const tableHead = document.getElementById('dataTable').getElementsByTagName('thead')[0];
                            tableHead.innerHTML = `
                                <tr>
                                    <th>Strike/Maturity</th>  <!-- Explicit header for Strike/Maturity -->
                                    ${headers.slice(1).map(header => `<th>${header}</th>`).join('')}
                                </tr>
                            `;

                           
                            data.forEach(record => {
                                const row = tableBody.insertRow();
                                const strikeCell = row.insertCell();
                                const strikeValue = record['Strike/Maturity'];
                                strikeCell.textContent = strikeValue ? strikeValue : 'N/A';
                                headers.slice(1).forEach(header => {
                                    const cell = row.insertCell();
                                    const value = record[header];
                                    if (value !== "N/A" && !isNaN(value)) {
                                        cell.textContent = roundNumber(value, 2); // Round to 2 decimal places
                                    } else {
                                        cell.textContent = value !== "N/A" ? value : 'N/A';
                                    }
                                });
                            });
                        } else {
                            const tableBody = document.getElementById('dataTable').getElementsByTagName('tbody')[0];
                            tableBody.innerHTML = '<tr><td colspan="9">No data available</td></tr>';
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching data:', error);
                        const tableBody = document.getElementById('dataTable').getElementsByTagName('tbody')[0];
                        tableBody.innerHTML = '<tr><td colspan="9">Error fetching data</td></tr>';
                    });
            }
        }
    </script>

</body>
</html>
