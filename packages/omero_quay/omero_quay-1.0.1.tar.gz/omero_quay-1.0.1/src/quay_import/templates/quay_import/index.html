{% load static %}
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"
      >
    </script>
    {# <script #}
    {#   src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" #}
    {#   integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" #}
    {#   crossorigin="anonymous" #}
    {#   > #}
    {# </script> #}
    {# <script #}
    {#   src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" #}
    {#   integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" #}
    {#   crossorigin="anonymous" #}
    {#   > #}
    {# </script> #}
    <title>Import to fbi-omero</title>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
      />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous">
    <link
      rel="stylesheet"
      type="text/css"
      href="https://fonts.googleapis.com/css?family=Open+Sans"
      />
    <link
      rel="stylesheet"
      type="text/css"
      href="{% static 'quay_import/app.css' %}"
    />
    <link rel="stylesheet" href="{% static 'app.css' %}">
  </head>

  <body>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
      ></script>

    <div class="head">
      <h1>Outil de transfert du serveur tampon vers le mésocentre</h1>
      <p>
        Logged in as:
        <!-- Django template renders values from context -->
        <strong>{{ firstName }} {{ lastName }}</strong>
      </p>
    </div>

    <div class="sub_head">
      <h5>Sélectionnez le fichier XLSX de votre jeu de données:</h5>
    </div>

    <form
      id="main_form"
      name="main_form"
      method="post"
      enctype="multipart/form-data"
    >
      <!-- hidden field with CSRF token -->
      {% csrf_token %}
      <div>
        <p>
          <label for="myfile" class="custom-button">
            Sélectionnez un fichier XLSX
          </label>
          <input
            type="file"
            id="myfile"
            class="custom-file-input"
            name="myfile"
            accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
          />
        </p>
        <p id="loaded_file"></p>
        <p>
          <input
            type="submit"
            id="send_button"
            name="send_button"
            class="custom-button"
            value="{% block submit_text %}Envoyer vers tampon{% endblock %}"
            disabled
          />
        </p>
      </div>
      <div class="sub_head">
        <h5>"Liste de fichiers en attente d'importation vers mésocentre"</h5>
        {% for file in list_of_files %}
        <tr>
          <td>
            <i class="fa fa-file"></i>
            <div class="checkbox">
              <label>
                <input
                  type="checkbox"
                  name="{{ file }}"
                  id="checkbox-{{ forloop.counter }}"
                />
                <label for="checkbox-{{ forloop.counter }}"> {{ file }}</label
                ><br />
              </label>
            </div>
          </td>
        </tr>
        {% endfor %}
      </div>

      <div>
        <p>
          <input
            type="submit"
            id="delete_button"
            name="delete_button"
            class="custom-button"
            value="{% block submit_text_2 %}Effacer du tampon{% endblock %}"
          />
        </p>
        <p>
          <input
            type="submit"
            id="send_files_to_mesocenter"
            name="send_files_to_mesocenter"
            class="custom-button"
            value="{% block submit_text_3 %}Envoyer du tampon vers mésocentre{% endblock %}"
          />
        </p>
      </div>

    <div class="sub_head">
      <h5>Statuts des imports :</h5>
    </div>

      <div class="d-flex flex-column justify-content-center">
        <div class="row mb-6 text-center">
          <div class="col themed-grid-col">
            Manager
          </div>
          <div class="col themed-grid-col">
            Investigation
          </div>
          {% for job in jobs %}
          <div class="col themed-grid-col">
            {{ job }} status
          </div>
          {% endfor %}
        </div>
        {% for manifest in manifests %}
        {# mb-x should match the number of jobs + 1#}
        <div class="row mb-6' text-center">
          {% include "./manifest.html" %}
        </div>
        {% endfor %}
      </div>
      <div>
        {% for error in error_messages %}
        <h4>Error message : {{ error }}</h4>
        {% endfor %}
      </div>

      <div>{{ list_of_files_states }}</div>

      <div>{{ last_state_string }}</div>
    </form>

    <!--
      <div>
        {% if uploaded_file_url %}
          <p>File uploaded at: <a href="{{ uploaded_file_url }}">{{ uploaded_file_url }}</a></p>
        {% endif %}
      </div>
      -->

    <script>
      $("#myfile").change(function () {
        var i = $(this).prev("label").clone();
        var file = $("#myfile")[0].files[0].name;
        document.getElementById("loaded_file").innerHTML = file;
        console.log(file);
        $(this).prev("label").text(file);
        $("#send_button").prop("disabled", false);
      });

      var loop_counter = "{{forloop.counter}}";
      for (let count = 0; count < loop_counter; count++) {
        $(function () {
          $("#checkbox-" + count).click(function () {
            if ($(this).is(":checked")) {
              console.log("is checked");
              $("#delete_button").prop("disabled", false);
              $("#send_files_to_mesocenter").prop("disabled", false);
            } else {
              console.log("is not checked");
              $("#delete_button").prop("disabled", true);
              $("#send_files_to_mesocenter").prop("disabled", true);
            }
          });
        });
      }
    </script>
  </body>
</html>
