<!-- example_plugin/tab_device_detail_1.html -->
{% extends 'dcim/device/base.html' %}
{% load static %}
{% load form_helpers %}
{% load i18n %}
{% load helpers %}
{% load plugins %}

{% block content %}
<div class="row px-3">
    <div class="col col-12 py-3 mx-auto px-0 plan-filter">
      <form action="" method="get" id="plan-form" class="form form-horizontal">
        <div>
          <div class="col-md-6 d-flex gap-2">
            <div class="w-50">
              {% render_form form %}
            </div>
            <div class="">
              <button type="submit" class="btn btn-primary planning-open">
                Open
              </button>
            </div>
          </div>
          <input type="hidden" value="none" name="refresh" id="refreshInput"/>
          <input type="hidden" value="none" name="sync" id="syncInput"/>
          <div class="col-md-6 text-end" style="text-align: right;">
            <div class="btn-group btn-group-sm" role="group">
              <!-- {% if appliance_type == 'both' or appliance_type == 'pull'  %}
                {% if connection_status == 'connected' %}
                  <a name="sync"  class="btn btn-orange btn-sm mx-2" id="sync">{% trans "Sync" %}</a>
                {% endif %}
              {% endif %} -->
              <select class="btn btn-secondary result-type" id="result-type" name="result_type">
                <option value="planning" {% if "result_type" not in request.GET or request.GET.result_type == 'planning' %}selected="selected"{% else %} {% endif %}>{% trans "Planning Result" %}</option>
                <option value="template" {% if request.GET.result_type == 'template' %}selected="selected"{% else %} {% endif %}>{% trans "Template Result" %}</option>
              </select>
            </div>
          </div>
         
        </div>
      </form>

      
    </div>
</div>

<div class="row px-3">
  <span style="padding-left: 20px;">
    <b>
      {{result_status}} results 

      {% if result_status == 'Cached' %}
        - <a id="refresh">Refresh data</a>
      {% endif %}

    </b>
    <b class="text-end cached_time">
      {% if result_status == 'Cached' %}
        {{ cached_time}}
      {% endif %}
    </b>
  </span>
  <div class="card">
    <div class="card-body htmx-container table-responsive" id="object_list">
      {% block table %}
        {% include "slurpit_nautobot/table1.html" %}
      {% endblock %}
    </div>
  </div>
</div>


<style>
  .plan-filter label {
    display: none !important;
  }
  .plan-filter button {
    height: 35px !important;
  }

  .result-type {
    height: 33px !important;
  }
  #refresh { 
    text-decoration: none;
    cursor: pointer;
    color: #0d6efd;
  }

  .cached_time {
    position: absolute;
    right: 24px;
  }
  .w-50 {
    width: 50%;
  }
  .d-flex {
    display: flex;
  }
  .col-md-9 {
    width: 95%;
  }
  .planning-open {
    line-height: 14px !important;
  }

  .btn-secondary {
    background-color: #adb5bd;
    color: #000 !important;
  }

</style>

<script>
  var selectElement = document.getElementById('result-type');
  var form = document.getElementById('plan-form');
  if(selectElement){
    selectElement.addEventListener('change', function(event) {
      form.submit();
    });
   }

  var refreshElement = document.getElementById('refresh');
  var refreshInput = document.getElementById('refreshInput');
  if(refreshElement){
    refreshElement.addEventListener('click', function(event) {
      refreshInput.value = "refresh";
      form.submit();
    });
  }


  var syncElement = document.getElementById('sync');
  var syncInput = document.getElementById('syncInput');
  if(syncElement){
    syncElement.addEventListener('click', function(event) {
      syncInput.value = "sync";
      form.submit();
    });
  }

 
</script>

{% endblock %}

{% block javascript %}
<script>
  var form = document.getElementById('plan-form');
  var refreshInput = document.getElementById('refreshInput');

  $("#id_planning_id").on('select2:select', function(e){
    form.submit();
  });

  function switch_tab(tab_href, reload=false) {

    let [tab_url, tab_id] = tab_href.split("#")

    if (location.pathname != "{{ object.get_absolute_url }}")
        window.location.href = `${tab_url}?tab=${tab_id}`;
    else if (window.history.state["id"] != tab_id){
        window.history.pushState({id: tab_id}, document.title, `${tab_url}?tab=${tab_id}`);
    }

    // If set, reload the page after asserting state.
    reload && window.location.reload();

  }

</script>
{% endblock %}

