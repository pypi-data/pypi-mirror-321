<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>8. Delta Publish and Subscribe &#8212; Python Developer Guide 5.3.4.0
 documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '5.3.4.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="9. High Availability" href="high-availability.html" />
    <link rel="prev" title="7. Using Queues" href="queues.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/flag_logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">8. Delta Publish and Subscribe</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#delta-subscribe">Delta Subscribe</a></li>
<li><a class="reference internal" href="#delta-publish">Delta Publish</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="queues.html" title="previous chapter">7. Using Queues</a></li>
      <li>Next: <a href="high-availability.html" title="next chapter">9. High Availability</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="delta-publish-and-subscribe">
<h1>8. Delta Publish and Subscribe<a class="headerlink" href="#delta-publish-and-subscribe" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Delta messaging in AMPS has two independent aspects:</p>
<ul class="simple">
<li><strong>Delta Subscribe</strong> - Allows subscribers to receive just the fields that
are updated within a message.</li>
<li><strong>Delta Publish</strong> - Allows publishers to update and add fields within a
message by publishing only the updates into the SOW.</li>
</ul>
<p>This chapter describes how to create delta publish and delta subscribe
commands using the AMPS Python client. For a discussion of this
capability, how it works, and how message types support this capability
see the <em>AMPS User Guide</em>.</p>
</div>
<div class="section" id="delta-subscribe">
<h2>Delta Subscribe<a class="headerlink" href="#delta-subscribe" title="Permalink to this headline">¶</a></h2>
<p>To delta subscribe, you simply use the <code class="docutils literal"><span class="pre">delta_subscribe</span></code> command as
follows:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># assumes that client is connected and logged on</span>

<span class="n">cmd</span> <span class="o">=</span> <span class="n">AMPS</span><span class="o">.</span><span class="n">Command</span><span class="p">(</span><span class="s2">&quot;delta_subscribe&quot;</span><span class="p">)</span>
<span class="n">cmd</span><span class="o">.</span><span class="n">set_topic</span><span class="p">(</span><span class="s2">&quot;delta_topic&quot;</span><span class="p">)</span>
<span class="n">cmd</span><span class="o">.</span><span class="n">set_filter</span><span class="p">(</span><span class="s2">&quot;/thingIWant = &#39;true&#39;&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">client</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">cmd</span><span class="p">):</span>
    <span class="c1"># Delta messages arrive here</span>
</pre></div>
</div>
<p>As described in the <em>AMPS User Guide</em>, messages provided to a delta
subscription will contain the fields used to generate the SOW key and
any changed fields in the message. Your application is responsible for
choosing how to handle the changed fields.</p>
</div>
<div class="section" id="delta-publish">
<h2>Delta Publish<a class="headerlink" href="#delta-publish" title="Permalink to this headline">¶</a></h2>
<p>To delta publish, you use the <code class="docutils literal"><span class="pre">delta_publish</span></code> command as follows:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># assumes that client is connected and logged on</span>

<span class="n">msg</span> <span class="o">=</span> <span class="o">...</span> <span class="c1"># obtain changed fields here</span>

<span class="n">client</span><span class="o">.</span><span class="n">delta_publish</span><span class="p">(</span><span class="s2">&quot;myTopic&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
</pre></div>
</div>
<p id="index-0">The message that you provide to AMPS must include the fields that the
topic uses to generate the SOW key. Otherwise, AMPS will not be able to
identify the message to update. For SOW topics that use a User-Generated
SOW Key, use the <code class="docutils literal"><span class="pre">Command</span></code> form of <code class="docutils literal"><span class="pre">delta_publish</span></code> to set the
<code class="docutils literal"><span class="pre">SowKey</span></code>, as shown below:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># assumes that client is connected and logged on</span>

<span class="n">msg</span> <span class="o">=</span> <span class="o">...</span> <span class="c1"># obtain changed fields here</span>
<span class="n">key</span> <span class="o">=</span> <span class="o">...</span> <span class="c1"># obtain user-generated SOW key</span>

<span class="n">cmd</span> <span class="o">=</span> <span class="n">AMPS</span><span class="o">.</span><span class="n">Command</span><span class="p">(</span><span class="s2">&quot;delta_publish&quot;</span><span class="p">)</span>
<span class="n">cmd</span><span class="o">.</span><span class="n">set_topic</span><span class="p">(</span><span class="s2">&quot;delta_topic&quot;</span><span class="p">)</span>
<span class="n">cmd</span><span class="o">.</span><span class="n">set_sow_key</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="n">cmd</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

<span class="c1"># Execute the delta publish. Use None for</span>
<span class="c1"># the message handler since any failure acks will</span>
<span class="c1"># be routed to the FailedWriteHandler.</span>
<span class="n">client</span><span class="o">.</span><span class="n">execute_async</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2022, 60East Technologies, Inc..
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>