import{a as $,b as M,t as Ce,e as Je}from"./disclose-version.C34ntcg3.mjs";import{i as ue}from"./legacy.CQjiHReU.mjs";import{h as rt,d as Kt,i as Ut,b0 as Zt,I as Jt,c as Vt,x as Yt,w as Gt,U as Qt,z as Xt,p as re,W as mt,F as ae,t as Z,b as ce,Z as ee,aH as te,g as e,J as ne,M as V,K as J,aC as F,a_ as Ne,s as u,n as ye,m as I,a0 as en,l as me,a as qe,b1 as ct,L as Ue,aF as Me,Y as tn,b2 as it,a$ as ut}from"./runtime.DAfjif0p.mjs";import{s as Pe,e as E,p as ft,b as Se,a as ie}from"./store.81G_Fa88.mjs";import{p as T,a as Te}from"./props.BsiIqcc_.mjs";import{c as pt}from"./Container.CbvB97wc.mjs";import{p as nn,e as _t,i as an}from"./theme.CTbh-T3R.mjs";import{r as sn,at as on,u as we,q as bt,t as le,by as ln,bz as rn,bA as cn,bB as un}from"./runtime-require.BYnIYq6X.mjs";import{b as yt}from"./IconButton.Bsplk8vF.mjs";import{s as fn,b as L,p as $e,t as dn,v as gn,f as St,I as Le,w as hn,x as vn,S as We,g as je,y as mn,o as pn,a as Tt,z as _n,A as bn,B as yn,C as dt,j as Sn,i as Tn}from"./Shortcut.DHDq_OLp.mjs";import{s as pe,x as wn}from"./backend.SD9iRJjK.mjs";import{c as fe,o as wt}from"./index-client.CsLEDI0D.mjs";import{d as kn,w as kt}from"./index.BHlJkaci.mjs";import{d as Ve,W as Ct,P as $t,D as Oe,B as Cn}from"./Badge.BcX8LcxP.mjs";import{a as $n}from"./input.rjbhKqap.mjs";import{b as Ye}from"./this.BUkeorvg.mjs";import{W as An}from"./WithTooltip.CM21lxIV.mjs";function Nn(a,t,d){rt&&Kt();var c=a,_=Qt,f,l=Ut()?Zt:Jt;Vt(()=>{l(_,_=t())&&(f&&Yt(f),f=Gt(()=>d(c)))}),rt&&(c=Xt)}function At(a){const t=a.getRootNode();return t.getSelection?t.getSelection():document.getSelection()}function Pn(a){const t=a.rangeCount;return t===0?null:a.getRangeAt(t-1)}const Pa=Symbol("direction"),Ge=Symbol("tagActionsShortcuts");function Dn(a,t,d){document.execCommand(a,t,d)}function Nt(a,t,d){if(!a.parentNode||a===t)return d;{const c=a.parentNode,_=[Array.prototype.indexOf.call(a.parentNode.childNodes,a),...d];return Nt(c,t,_)}}function gt(a,t){return Nt(a,t,[])}function Qe(a,t){if(t.length===0)return a;if(a.childNodes[t[0]]){const[d,...c]=t;return Qe(a.childNodes[d],c)}else return null}var Xe=(a=>(a[a.Before=-1]="Before",a[a.Equal=0]="Equal",a[a.After=1]="After",a))(Xe||{});function xn(a,t){const d=Math.min(a.coordinates.length,t.coordinates.length);for(let c=0;c<=d;c++){if(a.coordinates.length===c)return t.coordinates.length===c?a.offset<t.offset?-1:a.offset>t.offset?1:0:-1;if(t.coordinates.length===c)return 1;if(a.coordinates[c]<t.coordinates[c])return-1;if(a.coordinates[c]>t.coordinates[c])return 1}throw new Error("compareLocations: Should never happen")}function En(a){const t=At(a),d=Pn(t);if(!d)return null;const c=d.collapsed,f={coordinates:gt(t.anchorNode,a),offset:t.anchorOffset};if(c)return{anchor:f,collapsed:c};const r={coordinates:gt(t.focusNode,a),offset:t.focusOffset},v=xn(f,r)===Xe.After?"backward":"forward";return{anchor:f,focus:r,collapsed:c,direction:v}}function In(a){a.empty()}function Rn(a,t,d,c){const _=c.focus,f=_.offset,l=Qe(a,_.coordinates);c.direction==="forward"?(d.setEnd(l,f),t.addRange(d)):(t.addRange(d),t.extend(l,f))}function Wn(a){return En(a)}function jn(a,t){const d=At(a);In(d);const c=new Range,_=Qe(a,t.anchor.coordinates);c.setStart(_,t.anchor.offset),t.collapsed?(c.collapse(!0),d.addRange(c)):Rn(a,d,c,t)}sn("anki/location",{Position:Xe,restoreSelection:jn,saveSelection:Wn});const se="âˆ·";function Ze(a){return a.replace(/::/g,se)}function Be(a){return a.replace(/\u2237/gu,"::")}function ht(a){let t=a.trim();for(;t.startsWith(":")||t.startsWith(se);)t=t.slice(1).trimStart();for(;t.endsWith(":")||t.endsWith(se);)t=t.slice(0,-1).trimEnd();return t}function He(a){return{id:Math.random().toString(36).substring(2),name:a,selected:!1,flash:()=>{}}}function Bn(a){return a.name}const Ae=kt(null);kn(Ae,a=>()=>a==null?void 0:a.blur());var Mn=M('<input type="text" tabindex="-1" size="1">');function Ln(a,t){re(t,!1);const d=Pe(),c=()=>Se(Ae,"$currentTagInput",d);let _=T(t,"id",8,void 0),f=T(t,"class",8,""),l=T(t,"name",12),r=T(t,"input",12),h=T(t,"disabled",8);const v=fe();function y(){return r().selectionStart===r().selectionEnd}function k(){return r().selectionStart===0&&r().selectionEnd===0}function m(){return r().selectionStart===r().value.length&&r().selectionEnd===r().value.length}function s(o){r().setSelectionRange(o,o)}function P(){return l().length===0}async function w(o){const D=r().value.length;v("tagjoinprevious"),await ee(),s(r().value.length-D),o.preventDefault()}async function O(o,D){if(D>l().length)return;l().slice(0,D).endsWith(se)&&(l(l().slice(0,D-1)+l().slice(D,l().length)),await ee(),o.preventDefault(),s(D-1),v("taginput"))}function R(o){k()?w(o):O(o,r().selectionStart)}async function W(o){const D=r().value.length;v("tagjoinnext"),await ee(),s(D),o.preventDefault()}function j(o){m()?W(o):O(o,r().selectionStart+2)}function g(){l(ht(l())),l().length===0&&v("tagdelete"),v("tagaccept")}function z(o){v("tagsplit",{start:r().selectionStart,end:r().selectionEnd}),o.preventDefault()}async function N(o,D=!1){const A=r().selectionStart,x=r().selectionEnd,q=l().slice(0,A),Q=l().slice(x,l().length);if(q.endsWith(se)){o.preventDefault(),o.stopPropagation();return}else if(q.endsWith(":")){o.preventDefault(),l(`${q.slice(0,-1)}${se}${l().slice(x,l().length)}`),await ee(),s(A),v("taginput");return}else if(Q.startsWith(":"))o.preventDefault(),l(`${q}${se}${l().slice(x+1,l().length)}`);else{if(D)return;o.preventDefault(),l(`${q}${se}${Q}`)}await ee(),s(A+1),v("taginput")}function p(o){switch(o.code){case"Enter":z(o);break;case"Backspace":y()&&R(o);break;case"Delete":y()&&j(o);break}dn(o)?P()?w(o):k()&&(v("tagmoveprevious"),o.preventDefault()):gn(o)?P()?W(o):m()&&(v("tagmovenext"),o.preventDefault()):o.key===" "?N(o,!1):o.key===":"&&N(o,!0)}function C(o){const D=document.getSelection();o.clipboardData.setData("text/plain",Be(D.toString()))}function B(o){if(!o.clipboardData)return;const A=(l()+o.clipboardData.getData("text/plain")).split(/\s+/).map(ht).filter(q=>q.length>0).map(Ze);if(A.length===0)return;const x=A.pop();for(const q of A.reverse())l(q),v("tagadd");l(x)}function H(o){l().length===0&&(o.preventDefault(),o.stopPropagation(),v("tagselectall"))}const{selectAllShortcut:Y}=mt(Ge);wt(()=>{fn(H,Y,{target:r()}),r().focus()});function G(o){return ft(Ae,o),{destroy(){c()===o&&ft(Ae,null)}}}ue();var S=Mn();on(S),Ye(S,o=>r(o),()=>r()),ae(()=>$n(S,l)),ae(()=>E("focus",S,function(o){L.call(this,t,o)})),ae(()=>E("blur",S,$e(g))),ae(()=>E("keydown",S,p)),ae(()=>E("keydown",S,function(o){L.call(this,t,o)})),ae(()=>E("keyup",S,function(o){L.call(this,t,o)})),ae(()=>E("input",S,()=>v("taginput"))),ae(()=>E("copy",S,$e(C))),ae(()=>E("paste",S,$e(B))),Ve(S,o=>G==null?void 0:G(o)),Z(()=>{var o;we(S,"id",_()),bt(S,`tag-input ${(o=f())!=null?o:""} svelte-1nk8ij0`),le(S,"disabled",h())}),$(a,S),ce()}var qn=M("<!> <!>",1),zn=M('<div class="tag-add-button svelte-1fo7hj6" role="button"><!> <span class="tags-info svelte-1fo7hj6"><!></span></div> <!>',1);function Fn(a,t){re(t,!1);const d=Pe(),c=()=>Se(Ae,"$currentTagInput",d);let _=T(t,"keyCombination",8);const f=fe();function l(){f("tagappend")}ue();var r=zn(),h=te(r);const v=F(()=>{var w;return(w=ln())!=null?w:""}),y=F(()=>{var w;return(w=je(_()))!=null?w:""});Z(()=>we(h,"title",`${e(v)} (${e(y)})`));var k=ne(h);St(k,{children:(w,O)=>{var R=qn(),W=te(R);Le(W,{icon:hn});var j=V(W,2);Le(j,{icon:vn}),$(w,R)},$$slots:{default:!0}});var m=V(k,2),s=ne(m);pe(s,t,"default",{}),J(m),J(h);var P=V(h,2);We(P,{get keyCombination(){return _()},$$events:{action:()=>f("tagappend")}}),Z(()=>we(h,"tabindex",c()?-1:0)),E("click",h,l),E("focus",h,l),$(a,r),ce()}var On=M('<div class="tags-selected-button svelte-y9jxqs" role="button" tabindex="0"><!></div>'),Hn=M("<!> <!> <!>",1);function Kn(a,t){re(t,!1);const d=fe();let c=I(!1);const{selectAllShortcut:_,copyShortcut:f,removeShortcut:l}=mt(Ge);ue(),Ct(a,{get show(){return e(c)},preferredPlacement:"top",portalTarget:document.body,shift:0,children:Ne,$$slots:{default:(r,h)=>{const v=F(()=>h.asReference);var y=On(),k=en(()=>pn(()=>u(c,!e(c)))),m=ne(y);St(m,{children:(s,P)=>{Le(s,{icon:mn})},$$slots:{default:!0}}),J(y),Ve(y,s=>{var P;return(P=e(v))==null?void 0:P(s)}),ae(()=>E("click",y,()=>u(c,!e(c)))),ae(()=>E("keydown",y,function(...s){var P;(P=e(k))==null||P.apply(this,s)})),$(r,y)},floating:(r,h)=>{$t(r,{slot:"floating",children:(v,y)=>{var k=Hn(),m=te(k);Oe(m,{$$events:{click:()=>d("tagselectall")},children:(w,O)=>{ye();var R=Ce();const W=F(()=>{var g;return(g=rn())!=null?g:""}),j=F(()=>{var g;return(g=je(_))!=null?g:""});Z(()=>ie(R,`${e(W)} (${e(j)})`)),$(w,R)},$$slots:{default:!0}});var s=V(m,2);Oe(s,{$$events:{click:()=>d("tagcopy")},children:(w,O)=>{ye();var R=Ce();const W=F(()=>{var g;return(g=cn())!=null?g:""}),j=F(()=>{var g;return(g=je(f))!=null?g:""});Z(()=>ie(R,`${e(W)} (${e(j)})`)),$(w,R)},$$slots:{default:!0}});var P=V(s,2);Oe(P,{$$events:{click:()=>d("tagdelete")},children:(w,O)=>{ye();var R=Ce();const W=F(()=>{var g;return(g=un())!=null?g:""}),j=F(()=>{var g;return(g=je(l))!=null?g:""});Z(()=>ie(R,`${e(W)} (${e(j)})`)),$(w,R)},$$slots:{default:!0}}),$(v,k)},$$slots:{default:!0}})}}}),ce()}var Un=M('<div class="tag-options-button gap svelte-16efk4p"><!></div>');function Zn(a,t){let d=T(t,"badgeHeight",12),c=T(t,"tagsSelected",8),_=T(t,"keyCombination",8);var f=Un(),l=ne(f);Nn(l,c,r=>{var h=Je(),v=te(h);{var y=m=>{Kn(m,{$$events:{tagselectall(s){L.call(this,t,s)},tagcopy(s){L.call(this,t,s)},tagdelete(s){L.call(this,t,s)}}})},k=m=>{Fn(m,{get keyCombination(){return _()},$$events:{tagappend(s){L.call(this,t,s)}}})};Te(v,m=>{c()?m(y):m(k,!1)})}$(r,h)}),J(f),Tt(f,"offsetHeight",d),E("mousedown",f,$e(function(r){L.call(this,t,r)})),$(a,f)}function Jn(a,t){let d=T(t,"class",8,"");Cn(a,{get class(){var c;return`d-flex align-items-center ms-1 ${(c=d())!=null?c:""}`},iconSize:80,$$events:{click(c){L.call(this,t,c)}},children:(c,_)=>{Le(c,{icon:_n})},$$slots:{default:!0}})}var Vn=M('<button tabindex="-1"><!></button>');function Ke(a,t){re(t,!1);let d=T(t,"class",8,""),c=T(t,"tagName",8),_=T(t,"tooltip",8,void 0),f=T(t,"selected",8,!1);const l=fe();let r=I(!1);function h(){u(r,!0),setTimeout(()=>u(r,!1),300)}let v=I();wt(()=>l("mount",{button:e(v)})),ue();var y=Vn(),k=ne(y);return pe(k,t,"default",{}),J(y),Ye(y,m=>u(v,m),()=>e(v)),Z(()=>{var m;bt(y,`tag d-inline-flex align-items-center text-nowrap ps-2 pe-1 ${(m=d())!=null?m:""} svelte-1ywoj88`),we(y,"title",_()),we(y,"data-addon-tag",c()),le(y,"selected",f()),le(y,"flashing",e(r))}),E("mousemove",y,function(m){L.call(this,t,m)}),E("click",y,function(m){L.call(this,t,m)}),$(a,y),yt(t,"flash",h),ce({flash:h})}var Yn=M(" <!>",1),Gn=M("<span> </span> <!>",1),Qn=M("<span> </span> <!>",1),Xn=M('<div class="svelte-11ejbji"><!></div>');function ea(a,t){re(t,!1);const d=Pe(),c=()=>Se(nn,"$pageTheme",d),_=I();let f=T(t,"name",8),l=T(t,"class",8,""),r=T(t,"tooltip",8),h=T(t,"selected",12),v=T(t,"active",8),y=T(t,"shorten",8),k=T(t,"flash",12);const m=fe();let s=I(!1),P=I(!1);function w(C){u(s,bn(C)),u(P,yn(C))}function O(){e(P)?m("tagrange"):e(s)?m("tagselect"):m("tagclick")}function R(C){const B=C.split(se);return B.length===1?C:`â€¦${se}`+B[B.length-1]}function W(C){return C.split(se).length>1}const j="tag-icon-hover";me(()=>(e(s),e(P)),()=>{u(_,e(s)||e(P))}),qe(),ue();var g=Xn();E("keydown",ct.body,w),E("keyup",ct.body,w);var z=ne(g);{var N=C=>{Ke(C,{get class(){return l()},get tagName(){return f()},$$events:{mousemove:w,click:O},children:(B,H)=>{ye();var Y=Yn(),G=te(Y),S=V(G);pe(S,t,"default",{get selectMode(){return e(_)},hoverClass:j}),Z(()=>{var o;return ie(G,`${(o=f())!=null?o:""} `)}),$(B,Y)},$$slots:{default:!0}})},p=C=>{var B=Je(),H=te(B);{var Y=S=>{An(S,{get tooltip(){return r()},trigger:"hover",placement:"top",children:Ne,$$slots:{default:(o,D)=>{const A=F(()=>D.createTooltip);Ke(o,{get class(){return l()},get tagName(){return f()},get flash(){return k()},set flash(x){k(x)},get selected(){return h()},set selected(x){h(x)},$$events:{mousemove:w,click:O,mount:x=>e(A)(x.detail.button)},children:(x,q)=>{var Q=Gn(),de=te(Q),K=ne(de,!0);Z(()=>ie(K,R(f()))),J(de);var X=V(de,2);pe(X,t,"default",{get selectMode(){return e(_)},hoverClass:j}),$(x,Q)},$$slots:{default:!0},$$legacy:!0})}}})},G=S=>{Ke(S,{get class(){return l()},get tagName(){return f()},get flash(){return k()},set flash(o){k(o)},get selected(){return h()},set selected(o){h(o)},$$events:{mousemove:w,click:O},children:(o,D)=>{var A=Qn(),x=te(A),q=ne(x,!0);J(x);var Q=V(x,2);pe(Q,t,"default",{get selectMode(){return e(_)},hoverClass:j}),Z(()=>ie(q,f())),$(o,A)},$$slots:{default:!0},$$legacy:!0})};Te(H,S=>{y()&&W(f())?S(Y):S(G,!1)},!0)}$(C,B)};Te(z,C=>{v()?C(N):C(p,!1)})}J(g),Z(()=>{le(g,"select-mode",e(_)),le(g,"night-mode",c().isDark),le(g,"empty",f()==="")}),$(a,g),ce()}function ta(a,t){re(t,!1);let d=T(t,"name",8),c=T(t,"class",8,""),_=T(t,"tooltip",8),f=T(t,"selected",8),l=T(t,"active",8),r=T(t,"shorten",8),h=T(t,"flash",8);const v=fe();function y(){v("tagdelete")}ue(),ea(a,{get name(){return d()},get class(){return c()},get tooltip(){return _()},get selected(){return f()},get active(){return l()},get shorten(){return r()},get flash(){return h()},$$events:{tagrange(k){L.call(this,t,k)},tagselect(k){L.call(this,t,k)},tagclick:()=>v("tagedit")},children:Ne,$$slots:{default:(k,m)=>{const s=F(()=>m.selectMode),P=F(()=>m.hoverClass);Jn(k,{get class(){return e(P)},$$events:{click:w=>{e(s)||(y(),w.stopPropagation())}}})}}}),ce()}var na=M('<div class="tag-spacer svelte-1k3couf" role="textbox" tabindex="-1"><br></div>');function aa(a,t){var d=na();E("click",d,function(c){L.call(this,t,c)}),$(a,d)}var sa=M('<div tabindex="-1" class="autocomplete-item svelte-1pjq6zk" role="button"><!></div>');function vt(a,t){re(t,!1);let d=T(t,"selected",8,!1),c=T(t,"active",8,!1),_=T(t,"suggestion",8),f=I();me(()=>(Ue(d()),e(f)),()=>{d()&&e(f)&&e(f).scrollIntoViewIfNeeded({behavior:"smooth",block:"start"})}),qe();var l=sa(),r=ne(l);pe(r,t,"default",{}),J(l),Ye(l,h=>u(f,h),()=>e(f)),Z(()=>{we(l,"data-addon-suggestion",_()),le(l,"selected",d()),le(l,"active",c())}),E("mousedown",l,$e(function(h){L.call(this,t,h)})),E("mouseup",l,function(h){L.call(this,t,h)}),E("mouseenter",l,function(h){L.call(this,t,h)}),E("mouseleave",l,function(h){L.call(this,t,h)}),$(a,l),ce()}var oa=M('<span class="autocomplete-reference svelte-1bkz961"><!></span>'),la=M('<div class="autocomplete-menu svelte-1bkz961"></div>'),ra=M('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1);function ca(a,t){re(t,!1);const d=Pe(),c=()=>Se(f(),"$show",d);let _=T(t,"suggestionsPromise",8),f=T(t,"show",8),l=I([]),r=I(null),h=I(!1);const v=fe();function y(){e(r)===null?u(r,0):e(r)>=e(l).length-1?u(r,null):Me(r)}function k(){e(r)===null?u(r,e(l).length-1):e(r)===0?u(r,null):Me(r,-1)}async function m(){var p;v("select",{selected:e(l)[(p=e(r))!=null?p:-1]})}async function s(){y(),await m()}async function P(){k(),await m()}async function w(){var p;e(l).length&&(u(h,!0),v("choose",{chosen:e(l)[(p=e(r))!=null?p:-1]}),await ee(),f().set(!1))}async function O(){await ee(),v("update")}function R(){return e(r)!==null}function W(){return{selectPrevious:P,selectNext:s,chooseSelected:w,update:O,hasSelected:R}}function j(p){u(r,p),u(h,!0)}function g(p){j(p)}async function z(p){u(h,!1),v("select",{selected:e(l)[p]})}function N(p,C){p.buttons===1&&j(C)}me(()=>(Ue(_()),Ue(f()),dt),()=>{_().then(p=>{f().set(p.length>0),dt()&&navigator.userAgent.match(/Chrome\/77/)&&(p=p.slice(0,10)),u(l,p)})}),qe(),ue(),Ct(a,{keepOnKeyup:!0,get show(){return c()},preferredPlacement:"top",portalTarget:document.body,$$events:{close:()=>f().set(!1)},children:Ne,$$slots:{default:(p,C)=>{const B=F(()=>C.asReference);var H=oa(),Y=ne(H);pe(Y,t,"default",{createAutocomplete:W}),J(H),Ve(H,G=>{var S;return(S=e(B))==null?void 0:S(G)}),$(p,H)},floating:(p,C)=>{var B=ra(),H=te(B);pt(H,()=>({"--popover-padding-inline":"0"})),$t(H.lastChild,{slot:"floating",children:(Y,G)=>{var S=la();_t(S,5,()=>e(l),an,(o,D,A)=>{var x=Je(),q=te(x);{var Q=K=>{vt(K,{selected:!0,get active(){return e(h)},get suggestion(){return e(D)},$$events:{mousedown:()=>g(A),mouseup:()=>{z(A),w()},mouseenter:X=>N(X,A),mouseleave:()=>u(h,!1)},children:(X,De)=>{ye();var ge=Ce();Z(()=>ie(ge,e(D))),$(X,ge)},$$slots:{default:!0}})},de=K=>{vt(K,{get suggestion(){return e(D)},$$events:{mousedown:()=>g(A),mouseup:()=>{z(A),w()},mouseenter:X=>N(X,A)},children:(X,De)=>{ye();var ge=Ce();Z(()=>ie(ge,e(D))),$(X,ge)},$$slots:{default:!0}})};Te(q,K=>{A===e(r)?K(Q):K(de,!1)})}$(o,x)}),J(S),$(Y,S)},$$slots:{default:!0}}),J(H),$(p,B)}}}),ce()}var ia=M("<!> <!> <!>",1),ua=M('<div class="tag-relative svelte-1tsu84n"><!> <!></div>'),fa=M('<!> <div class="tag-editor svelte-1tsu84n"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <!> <!></div>',1);function Da(a,t){re(t,!1);const d=Pe(),c=()=>Se(h(),"$tags",d),_=()=>Se(w,"$show",d),f=I(),l=I(),r=I();let h=T(t,"tags",8),v=T(t,"keyCombination",8,"Control+Shift+T");const y="Control+A",k="Control+C",m="Backspace";tn(Ge,{selectAllShortcut:y,copyShortcut:k,removeShortcut:m});let s=I();function P(n){u(s,n.map(i=>He(Ze(i))))}const w=kt(!1),O=fe(),R=Promise.resolve([]);let W=I(R);function j(){const n=e(s).map(i=>i.name).map(Be);O("tagsupdate",{tags:n}),u(W,R)}let g=I(null),z=null,N=I(""),p=I(),C=I(),B=I(!1);async function H(n){const{tags:i}=await wn({input:n,matchLimit:500});return i}const Y=/^:?([^:].*?[^:]):?$/;function G(){const i=e(s)[e(g)].name;if(u(B,i.length===0),e(B))u(W,R);else{const b=Be(i),U=Y.test(b)?b.replace(Y,"$1"):b;u(W,H(U).then(oe=>(u(B,oe.length===0),oe.map(Ze))))}}function S(n){const i=e(s)[e(g)];u(N,n!=null?n:i.name);const b=e(p).value.length;e(p).setSelectionRange(b,b)}async function o(n){n.name=e(N),u(s,e(s)),await ee(),e(p)&&e(C).update()}function D(n){z===null&&(z=n)}function A(){_e();const n=e(s)[e(s).length-1];(!n||n.name.length>0)&&x(e(s).length-1,"");const i=e(g)===null;u(g,null),i&&et()}function x(n,i){e(s).splice(n+1,0,He(i)),u(s,e(s)),D(n+1)}function q(n){const i=e(s).map(Bn);i.splice(n,1);const b=i.indexOf(e(N));return b>=0?(e(s)[b>=n?b+1:b].flash(),!1):!0}async function Q(n,i,b){const U=e(N).slice(0,i),oe=e(N).slice(b);u(N,U),await ee(),x(n,oe),u(g,null),await ee(),n!==e(g)&&e(p).setSelectionRange(0,0)}function de(n){q(n)&&(e(s).splice(n,0,He(e(N))),Me(g),u(s,e(s)))}function K(n){const i=e(s).splice(n,1)[0];return u(s,e(s)),z!==null&&z>n&&z--,i}function X(n){return n===0}function De(n){return n===e(s).length-1}function ge(n){if(X(n))return;const i=K(n-1);u(N,i.name+e(N)),Me(g,-1),o(e(s)[e(g)])}function Pt(n){if(De(n))return;const i=K(n+1);u(N,e(N)+i.name),o(e(s)[e(g)])}function Dt(n){X(n)||(z=n-1,u(g,null),e(p).blur())}async function xt(n){if(De(n)){e(N).length!==0&&(x(n,""),u(g,null));return}z=n+1,u(g,null),e(p).blur(),await ee(),e(p).setSelectionRange(0,0)}function Et(n,i){e(s).includes(n)&&(q(i)||K(i))}function et(){u(g,z),z=null}function It(n){if(Sn(n)){e(C).selectPrevious(),n.preventDefault();return}else if(Tn(n)){e(C).selectNext(),n.preventDefault();return}switch(n.code){case"Tab":if(_())n.shiftKey?e(C).selectPrevious():e(C).selectNext();else break;n.preventDefault();break;case"Enter":e(C).chooseSelected(),n.preventDefault();break}}let ke=null,xe=null;function tt(n){ut(s,e(s)[n].selected=!e(s)[n].selected),u(s,e(s)),ke=n}function Rt(n){if(ke===null){tt(n);return}xe=n;const i=Math.min(ke,xe),b=Math.max(ke,xe);for(let U=i;U<=b;U++)ut(s,e(s)[U].selected=!0);u(s,e(s))}function _e(){u(s,e(s).map(n=>({...n,selected:!1}))),ke=null,xe=null}function Wt(n){const i=n.currentTarget;(n.relatedTarget===null||!i.contains(n.relatedTarget))&&_e()}function jt(n){const i=document.createElement("textarea");i.value=n,i.setAttribute("readonly",""),i.style.position="absolute",i.style.left="-9999px",document.body.appendChild(i),i.select(),Dn("copy"),document.body.removeChild(i)}function ze(){for(const n of e(s))n.selected=!0;u(s,e(s))}function nt(){const n=e(s).filter(i=>i.selected).map(i=>Be(i.name)).join(`
`);jt(n),_e()}function at(){e(s).map((n,i)=>[n.selected,i]).filter(([n])=>n).reverse().forEach(([,n])=>K(n)),_e(),j()}let Fe=I(),Ee=I();me(()=>c(),()=>{P(c())}),me(()=>(e(Fe),e(Ee)),()=>{u(f,Math.floor(e(Fe)/e(Ee)))}),me(()=>(e(l),e(f)),()=>{u(l,e(l)||e(f)>2)}),me(()=>e(s),()=>{u(r,e(s).some(n=>n.selected))}),qe(),ue();var st=fa(),ot=te(st);{var Bt=n=>{var i=ia(),b=te(i);We(b,{keyCombination:y,$$events:{action:ze}});var U=V(b,2);We(U,{keyCombination:k,$$events:{action:nt}});var oe=V(U,2);We(oe,{keyCombination:m,$$events:{action:at}}),$(n,i)};Te(ot,n=>{e(r)&&n(Bt)})}var Ie=V(ot,2),Re=ne(Ie);pt(Re,()=>({"--icon-align":"baseline"})),Zn(Re.lastChild,{get tagsSelected(){return e(r)},get keyCombination(){return v()},get badgeHeight(){return e(Ee)},set badgeHeight(n){u(Ee,n)},$$events:{tagselectall:ze,tagcopy:nt,tagdelete:at,tagappend:A},$$legacy:!0}),J(Re);var lt=V(Re,2);_t(lt,3,()=>e(s),n=>n.id,(n,i,b)=>{var U=ua(),oe=ne(U),Lt=F(()=>e(b)===e(g)?e(N):e(i).name),qt=F(()=>e(b)===e(g));ta(oe,{class:"ms-0",get name(){return e(Lt)},get tooltip(){return e(i).name},get active(){return e(qt)},get shorten(){return e(l)},get flash(){return e(i).flash},set flash(he){e(i).flash=he,it(()=>e(s))},get selected(){return e(i).selected},set selected(he){e(i).selected=he,it(()=>e(s))},$$events:{tagedit:()=>{u(g,e(b)),_e()},tagselect:()=>tt(e(b)),tagrange:()=>Rt(e(b)),tagdelete:()=>{_e(),K(e(b)),j()}},$$legacy:!0});var zt=V(oe,2);{var Ft=he=>{ca(he,{get suggestionsPromise(){return e(W)},show:w,$$events:{update:G,select:({detail:ve})=>S(ve.selected),choose:({detail:ve})=>{S(ve.chosen),Q(e(b),ve.chosen.length,ve.chosen.length)}},children:Ne,$$slots:{default:(ve,Ot)=>{const Ht=F(()=>Ot.createAutocomplete);Ln(ve,{get id(){return e(i).id},class:"position-absolute start-0 top-0 bottom-0 ps-2 py-0",get disabled(){return e(B)},get name(){return e(N)},set name(be){u(N,be)},get input(){return e(p)},set input(be){u(p,be)},$$events:{focus:()=>{O("tagsFocused"),u(N,e(i).name),u(C,e(Ht)())},keydown:It,keyup:()=>{e(N).length===0&&(w==null||w.set(!1))},taginput:()=>o(e(i)),tagsplit:({detail:be})=>Q(e(b),be.start,be.end),tagadd:()=>de(e(b)),tagdelete:()=>K(e(b)),tagselectall:async()=>{e(s).length<=1||(e(p).blur(),await ee(),ze())},tagjoinprevious:()=>ge(e(b)),tagjoinnext:()=>Pt(e(b)),tagmoveprevious:()=>Dt(e(b)),tagmovenext:()=>xt(e(b)),tagaccept:()=>{Et(e(i),e(b)),e(i)&&o(e(i)),j(),et()}},$$legacy:!0})}}})};Te(zt,he=>{e(b)===e(g)&&he(Ft)})}J(U),Z(()=>le(U,"hide-tag",e(b)===e(g))),$(n,U)});var Mt=V(lt,2);return aa(Mt,{$$events:{click:A}}),J(Ie),E("focusout",Ie,Wt),Tt(Ie,"offsetHeight",n=>u(Fe,n)),$(a,st),yt(t,"appendEmptyTag",A),ce({appendEmptyTag:A})}export{Da as T,Pa as d,Dn as e};
