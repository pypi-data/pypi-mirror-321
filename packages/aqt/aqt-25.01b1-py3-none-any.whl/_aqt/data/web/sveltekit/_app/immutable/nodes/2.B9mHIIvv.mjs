import{h as je,R as Y}from"../chunks/backend.SD9iRJjK.mjs";import{a as F,b as E,e as Re,n as Ke}from"../chunks/disclose-version.C34ntcg3.mjs";import{i as te}from"../chunks/legacy.CQjiHReU.mjs";import{p as ae,J as f,t as R,K as n,b as re,l as z,a as ce,M as b,g as o,m as V,s as G,L as ee,aH as ve}from"../chunks/runtime.DAfjif0p.mjs";import{p as J,a as H}from"../chunks/props.BsiIqcc_.mjs";import{a as k,s as $e,p as ie,b as De}from"../chunks/store.81G_Fa88.mjs";import{p as Pe}from"../chunks/stores.-SEIBBLC.mjs";import{c as Ye,C as Be}from"../chunks/Container.CbvB97wc.mjs";import{R as fe}from"../chunks/Row.C9YvKy-i.mjs";import{U as Oe,V as We,W as Ge,X as Ue,Y as ze,Z as He,_ as Le,$ as Fe,a0 as Ve,a1 as ke,a2 as Te,a3 as Je,a4 as Xe,a5 as Ze,a6 as Qe,a7 as et,a8 as tt,a9 as at,aa as rt,ab as st,ac as it,ad as lt,ae as nt,af as ot,ag as vt,ah as ct,ai as dt,q as Se,aj as we,ak as ut,al as ft,am as mt,an as pt,ao as gt,ap as bt,aq as ht,ar as _t,as as yt,u as St,at as ne,au as wt,av as xt,aw as Rt,ax as $t}from"../chunks/runtime-require.BYnIYq6X.mjs";import{e as X,i as Z}from"../chunks/theme.CTbh-T3R.mjs";import{t as W,D as Dt,T as Ce}from"../chunks/time.CAuCz362.mjs";import{y as Lt,z as me,A as Ft,B as kt,C as Tt,D as Ct,E as Et,F as xe,G as At,H as qt,I as Nt,J as Mt,K as It,L as jt,N as Kt,M as Pt}from"../chunks/HoverColumns.Dj-B_HSd.mjs";import{m as Yt}from"../chunks/min.D1slsF82.mjs";import{t as Bt}from"../chunks/time.CckXyyFZ.mjs";import{b as oe}from"../chunks/input.rjbhKqap.mjs";import{b as Ot}from"../chunks/this.BUkeorvg.mjs";import{w as Wt}from"../chunks/index.BHlJkaci.mjs";import{g as Gt}from"../chunks/entry.LPYBJhMh.mjs";function Ut(s){try{return BigInt(s)}catch{return null}}const zt=async({params:s})=>{const c=Ut(s.cardId);return{info:c!==null?await je({cid:c}):null}},Ga=Object.freeze(Object.defineProperty({__proto__:null,load:zt},Symbol.toStringTag,{value:"Module"}));var Ht=E('<div class="card-info-placeholder svelte-16vamgt"> </div>');function Vt(s,c){ae(c,!1),te();var r=Ht(),a=f(r,!0);R(()=>k(a,Oe())),n(r),F(s,r),re()}var Jt=E('<tr><th class="align-start svelte-1ws7hzc"> </th><td> </td></tr>'),Xt=E('<table class="stats-table align-start svelte-1ws7hzc"><tbody></tbody></table>');function Zt(s,c){ae(c,!1);let r=J(c,"stats",8);function a(e){return new Ce(Number(e)).dateString()}function d(e){const i=[];if(i.push({label:We(),value:a(e.added)}),e.firstReview!=null&&i.push({label:Ge(),value:a(e.firstReview)}),e.latestReview!=null&&i.push({label:Ue(),value:a(e.latestReview)}),e.dueDate!=null&&i.push({label:ze(),value:a(e.dueDate)}),e.duePosition!=null&&i.push({label:He(),value:e.duePosition}),e.interval&&i.push({label:Le(),value:W(e.interval*Dt)}),e.memoryState){let x=W(e.memoryState.stability*86400,!1,!1);if(e.memoryState.stability>31){const t=e.memoryState.stability.toFixed(0);x+=` (${t})`}i.push({label:Fe(),value:x});const p=((e.memoryState.difficulty-1)/9*100).toFixed(0);if(i.push({label:Ve(),value:`${p}%`}),e.fsrsRetrievability){const t=(e.fsrsRetrievability*100).toFixed(0);i.push({label:ke(),value:`${t}%`})}}else e.ease&&i.push({label:Te(),value:`${e.ease/10}%`});i.push({label:Je(),value:e.reviews}),i.push({label:Xe(),value:e.lapses}),e.totalSecs&&(i.push({label:Ze(),value:W(e.averageSecs)}),i.push({label:Qe(),value:W(e.totalSecs)})),i.push({label:et(),value:e.cardType}),i.push({label:tt(),value:e.notetype});let w;if(e.originalDeck?w=`${e.deck} (${e.originalDeck})`:w=e.deck,i.push({label:at(),value:w}),i.push({label:rt(),value:e.preset}),i.push({label:st(),value:e.cardId}),i.push({label:it(),value:e.noteId}),e.customData){let x;try{const p=JSON.parse(e.customData);x=Object.entries(p).map(([t,u])=>`${t}=${u}`).join(" ")}catch{x=e.customData}i.push({label:lt(),value:x})}return i}let l=V();z(()=>ee(r()),()=>{G(l,d(r()))}),ce(),te();var S=Xt(),$=f(S);X($,5,()=>o(l),Z,(e,i)=>{var w=Jt(),x=f(w),p=f(x,!0);n(x);var t=b(x),u=f(t,!0);n(t),n(w),R(()=>{k(p,o(i).label),k(u,o(i).value)}),F(e,w)}),n($),n(S),F(s,S),re()}const Qt=19/81,ea=-.5,ta=1e3;function pe(s,c){return Math.pow(c/s*Qt+1,ea)}var y=(s=>(s[s.Week=0]="Week",s[s.Month=1]="Month",s[s.Year=2]="Year",s[s.AllTime=3]="AllTime",s))(y||{});const aa={0:7,1:30,2:365,3:1/0};function ra(s,c){return s.filter(r=>r.daysSinceFirstLearn<=c)}function ge(s){return s.reviewKind!==Y.MANUAL&&s.reviewKind!==Y.RESCHEDULED&&(s.reviewKind!==Y.FILTERED||s.ease!==0)}function sa(s){const c=[];for(const r of s){if(r.reviewKind===Y.MANUAL&&r.ease===0)break;c.push(r)}return c.filter(r=>ge(r))}function ia(s,c){const r=[];let a=0,d=0;const l=Math.min(c/ta,1);let S=0;if(s.slice().reverse().forEach((p,t)=>{var q,v;const u=Number(p.time);if(t===0){a=u,d=((q=p.memoryState)==null?void 0:q.stability)||0,r.push({date:new Date(u*1e3),daysSinceFirstLearn:0,elapsedDaysSinceLastReview:0,retrievability:100,stability:d});return}const m=(u-a)/(24*60*60);let h=0;for(;h<m-l;){h+=l;const D=pe(d,h);r.push({date:new Date((a+h*86400)*1e3),daysSinceFirstLearn:r[r.length-1].daysSinceFirstLearn+l,elapsedDaysSinceLastReview:h,retrievability:D*100,stability:d})}S+=m,r.push({date:new Date((a+m*86400)*1e3),daysSinceFirstLearn:S,retrievability:100,elapsedDaysSinceLastReview:0,stability:d}),a=u,d=((v=p.memoryState)==null?void 0:v.stability)||0}),r.length===0)return[];const $=Date.now()/1e3,e=($-a)/(24*60*60);let i=0;for(;i<e-l;){i+=l;const p=pe(d,i);r.push({date:new Date((a+i*86400)*1e3),daysSinceFirstLearn:r[r.length-1].daysSinceFirstLearn+l,elapsedDaysSinceLastReview:i,retrievability:p*100,stability:d})}S+=e;const w=pe(d,e);return r.push({date:new Date($*1e3),daysSinceFirstLearn:S,elapsedDaysSinceLastReview:e,retrievability:w*100,stability:d}),ra(r,c)}function Ee(s,c){if(s.length===0)return 0;const r=(Date.now()/1e3-Number(s[s.length-1].time))/(24*60*60);return Math.min(r,aa[c])}function la(s,c,r,a,d){const l=Lt(r),S=l.transition().duration(600);if(s.length===0){me(l,!1);return}const $=Ee(s,c),e=ia(s,$);if(e.length===0){me(l,!1);return}else me(l,!0);l.select(".forgetting-curve-line").remove(),l.select(".hover-columns").remove();const i=Yt(e,v=>v.date),w=Ft(e,v=>v.date),x=Bt().domain([i,w]).range([a.marginLeft,a.width-a.marginRight]),p=Math.max(0,100-1.2*(100-Math.min(...e.map(v=>v.retrievability)))),t=kt().domain([p,100]).range([a.height-a.marginBottom,a.marginTop]);l.select(".x-ticks").call(v=>v.transition(S).call(Tt(x).ticks(5).tickSizeOuter(0))).attr("direction","ltr"),l.select(".y-ticks").attr("transform",`translate(${a.marginLeft},0)`).call(v=>v.transition(S).call(Ct(t).tickSizeOuter(0))).attr("direction","ltr"),l.select(".y-ticks .y-axis-title").remove(),l.select(".y-ticks").append("text").attr("class","y-axis-title").attr("transform","rotate(-90)").attr("y",0-a.marginLeft).attr("x",0-a.height/2).attr("font-size","1rem").attr("dy","1.1em").attr("fill","currentColor").style("text-anchor","middle").text(`${nt()}(%)`);const u=Et().x(v=>x(v.date)).y(v=>t(v.retrievability)),m=d*100;l.append("linearGradient").attr("id","line-gradient").attr("gradientUnits","userSpaceOnUse").attr("x1",0).attr("y1",t(0)).attr("x2",0).attr("y2",t(100)).selectAll("stop").data([{offset:"0%",color:"tomato"},{offset:`${m}%`,color:"steelblue"},{offset:"100%",color:"green"}]).enter().append("stop").attr("offset",v=>v.offset).attr("stop-color",v=>v.color),l.append("path").datum(e).attr("class","forgetting-curve-line").attr("fill","none").attr("stroke","url(#line-gradient)").attr("stroke-width",1.5).attr("d",u),l.select(".desired-retention-line").remove(),m>p&&l.append("line").attr("class","desired-retention-line").attr("x1",a.marginLeft).attr("x2",a.width-a.marginRight).attr("y1",t(m)).attr("y2",t(m)).attr("stroke","steelblue").attr("stroke-dasharray","4 4").attr("stroke-width",1.2);const h=l.append("line").attr("class","focus-line").attr("y1",a.marginTop).attr("y2",a.height-a.marginBottom).attr("stroke","black").attr("stroke-width",1).style("opacity",0);function q(v){return`${$>=365?"Date":"Date Time"}: ${$>=365?v.date.toLocaleDateString():v.date.toLocaleString()}<br>
        ${vt()}: ${W(v.elapsedDaysSinceLastReview*86400)}<br>${ke()}: ${v.retrievability.toFixed(2)}%<br>${Fe()}: ${W(v.stability*86400)}`}l.append("g").attr("class","hover-columns").selectAll("rect").data(e).join("rect").attr("x",v=>x(v.date)-1).attr("y",a.marginTop).attr("width",2).attr("height",a.height-a.marginTop-a.marginBottom).attr("fill","transparent").on("mousemove",(v,D)=>{const[j,C]=xe(v,document.body),[K,B]=xe(v,l.node()),U=t(m);h.attr("x1",x(D.date)-1).attr("x2",x(D.date)+1).style("opacity",1);let Q=q(D);B>=U-10&&B<=U+10&&(Q+=`<br>${ot()}: ${d.toFixed(2)}`),At(Q,j,C)}).on("mouseout",()=>{h.style("opacity",0),qt()})}var na=E('<div class="svelte-1bf093q"><b> </b> <span class="hidden-xs svelte-1bf093q"> </span></div>'),oa=E("<div> </div>"),va=E("<div> </div>"),ca=E('<div class="svelte-1bf093q"> </div>'),da=E('<div class="svelte-1bf093q"> </div>'),ua=E('<div class="svelte-1bf093q"> </div>'),fa=E('<div class="revlog-table svelte-1bf093q"><div class="column svelte-1bf093q"><div class="column-head svelte-1bf093q"> </div> <div class="column-content svelte-1bf093q"></div></div> <div class="column hidden-xs svelte-1bf093q"><div class="column-head svelte-1bf093q"> </div> <div class="column-content svelte-1bf093q"></div></div> <div class="column svelte-1bf093q"><div class="column-head svelte-1bf093q"> </div> <div class="column-content svelte-1bf093q"></div></div> <div class="column svelte-1bf093q"><div class="column-head svelte-1bf093q"> </div> <div class="column-content right svelte-1bf093q"></div></div> <div class="column hidden-xs svelte-1bf093q"><div class="column-head svelte-1bf093q"> </div> <div class="column-content svelte-1bf093q"></div></div> <div class="column svelte-1bf093q"><div class="column-head svelte-1bf093q"> </div> <div class="column-content right svelte-1bf093q"></div></div> <!></div>');function ma(s,c){ae(c,!1);const r=V();let a=J(c,"revlog",8),d=J(c,"fsrsEnabled",8,!1);function l(t){switch(t.reviewKind){case Y.LEARNING:return"revlog-learn";case Y.REVIEW:return"revlog-review";case Y.RELEARNING:return"revlog-relearn"}return""}function S(t){switch(t.reviewKind){case Y.LEARNING:return _t();case Y.REVIEW:return ht();case Y.RELEARNING:return bt();case Y.FILTERED:return gt();case Y.MANUAL:return pt();case Y.RESCHEDULED:return mt()}}function $(t){return t.buttonChosen===1?"revlog-ease1":""}function e(t,u){var h;const m=new Ce(Number(t.time));return{date:m.dateString(),time:m.timeString(),reviewKind:S(t),reviewKindClass:l(t),rating:t.buttonChosen,ratingClass:$(t),interval:W(t.interval),ease:i(t.ease),takenSecs:W(t.takenSecs,!0),elapsedTime:u,stability:(h=t.memoryState)!=null&&h.stability?W(t.memoryState.stability*86400):""}}function i(t){if(t===0)return"";const u=t/10;return u<=110?`D:${(u-10).toFixed(0)}%`:`${u.toFixed(0)}%`}z(()=>(ee(a()),W),()=>{G(r,a().map((t,u)=>{let m,h=u+1;for(;h<a().length;){if(ge(a()[h])){m=a()[h];break}h++}let q="N/A";return ge(t)&&(q=m?W(Number(t.time)-Number(m.time)):"0"),e(t,q)}))}),ce(),te();var w=Re(),x=ve(w);{var p=t=>{var u=fa(),m=f(u),h=f(m),q=f(h,!0);R(()=>k(q,ct())),n(h);var v=b(h,2);X(v,5,()=>o(r),Z,(M,I)=>{var _=na(),P=f(_),Me=f(P,!0);n(P);var _e=b(P,2),Ie=f(_e);n(_e),n(_),R(()=>{var ye;k(Me,o(I).date),k(Ie,`@ ${(ye=o(I).time)!=null?ye:""}`)}),F(M,_)}),n(v),n(m);var D=b(m,2),j=f(D),C=f(j,!0);R(()=>k(C,dt())),n(j);var K=b(j,2);X(K,5,()=>o(r),Z,(M,I)=>{var _=oa(),P=f(_,!0);n(_),R(()=>{Se(_,we(o(I).reviewKindClass),"svelte-1bf093q"),k(P,o(I).reviewKind)}),F(M,_)}),n(K),n(D);var B=b(D,2),U=f(B),Q=f(U,!0);R(()=>k(Q,ut())),n(U);var le=b(U,2);X(le,5,()=>o(r),Z,(M,I)=>{var _=va(),P=f(_,!0);n(_),R(()=>{Se(_,we(o(I).ratingClass),"svelte-1bf093q"),k(P,o(I).rating)}),F(M,_)}),n(le),n(B);var se=b(B,2),T=f(se),A=f(T,!0);R(()=>k(A,Le())),n(T);var g=b(T,2);X(g,5,()=>o(r),Z,(M,I)=>{var _=ca(),P=f(_,!0);n(_),R(()=>k(P,o(I).interval)),F(M,_)}),n(g),n(se);var N=b(se,2),O=f(N),L=f(O,!0);R(()=>k(L,Te())),n(O);var be=b(O,2);X(be,5,()=>o(r),Z,(M,I)=>{var _=da(),P=f(_,!0);n(_),R(()=>k(P,o(I).ease)),F(M,_)}),n(be),n(N);var de=b(N,2),ue=f(de),Ae=f(ue,!0);R(()=>k(Ae,ft())),n(ue);var he=b(ue,2);X(he,5,()=>o(r),Z,(M,I)=>{var _=ua(),P=f(_,!0);n(_),R(()=>k(P,o(I).takenSecs)),F(M,_)}),n(he),n(de);var qe=b(de,2);{var Ne=M=>{};H(qe,M=>{d()&&M(Ne)})}n(u),F(t,u)};H(x,t=>{a().length>0&&t(p)})}F(s,w),re()}var pa=E('<label class="svelte-6ja67r"><input type="radio" class="svelte-6ja67r"> </label>'),ga=E('<label class="svelte-6ja67r"><input type="radio" class="svelte-6ja67r"> </label>'),ba=E('<label class="svelte-6ja67r"><input type="radio" class="svelte-6ja67r"> </label>'),ha=E('<label class="svelte-6ja67r"><input type="radio" class="svelte-6ja67r"> </label>'),_a=E('<div class="time-range-selector svelte-6ja67r"><!> <!> <!> <!></div>'),ya=Ke("<svg><!><!><!></svg>"),Sa=E('<div class="forgetting-curve svelte-6ja67r"><!> <!></div>');function wa(s,c){ae(c,!1);const r=$e(),a=()=>De(t,"$timeRange",r),d=V(),l=V(),S=[];let $=J(c,"revlog",8),e=J(c,"desiredRetention",8),i=V(null);const w=Pt(),x=yt();let p=V(y.Week);const t=Wt(o(p));z(()=>ee($()),()=>{G(d,sa($()))}),z(()=>(o(d),y),()=>{G(l,Ee(o(d),y.AllTime))}),z(()=>(o(l),y),()=>{o(l)>365?G(p,y.AllTime):o(l)>30?G(p,y.Year):o(l)>7&&G(p,y.Month)}),z(()=>o(p),()=>{ie(t,o(p))}),z(()=>(o(d),a(),o(i),ee(e())),()=>{la(o(d),a(),o(i),w,e())}),ce(),te();var u=Sa(),m=f(u);Nt(m,{children:(q,v)=>{var D=_a(),j=f(D);{var C=T=>{var A=pa(),g=f(A);ne(g);var N,O=b(g);R(()=>{var L;return k(O,` ${(L=wt())!=null?L:""}`)}),n(A),R(()=>{N!==(N=y.Week)&&(g.value=(g.__value=y.Week)==null?"":y.Week)}),oe(S,[],g,()=>(y.Week,a()),L=>ie(t,L)),F(T,A)};H(j,T=>{o(l)>0&&T(C)})}var K=b(j,2);{var B=T=>{var A=ga(),g=f(A);ne(g);var N,O=b(g);R(()=>{var L;return k(O,` ${(L=xt())!=null?L:""}`)}),n(A),R(()=>{N!==(N=y.Month)&&(g.value=(g.__value=y.Month)==null?"":y.Month)}),oe(S,[],g,()=>(y.Month,a()),L=>ie(t,L)),F(T,A)};H(K,T=>{o(l)>7&&T(B)})}var U=b(K,2);{var Q=T=>{var A=ba(),g=f(A);ne(g);var N,O=b(g);R(()=>{var L;return k(O,` ${(L=Rt())!=null?L:""}`)}),n(A),R(()=>{N!==(N=y.Year)&&(g.value=(g.__value=y.Year)==null?"":y.Year)}),oe(S,[],g,()=>(y.Year,a()),L=>ie(t,L)),F(T,A)};H(U,T=>{o(l)>30&&T(Q)})}var le=b(U,2);{var se=T=>{var A=ha(),g=f(A);ne(g);var N,O=b(g);R(()=>{var L;return k(O,` ${(L=$t())!=null?L:""}`)}),n(A),R(()=>{N!==(N=y.AllTime)&&(g.value=(g.__value=y.AllTime)==null?"":y.AllTime)}),oe(S,[],g,()=>(y.AllTime,a()),L=>ie(t,L)),F(T,A)};H(le,T=>{o(l)>365&&T(se)})}n(D),F(q,D)},$$slots:{default:!0}});var h=b(m,2);Mt(h,{title:x,children:(q,v)=>{var D=ya(),j=f(D);It(j,{bounds:w});var C=b(j);jt(C);var K=b(C);Kt(K,{bounds:w}),n(D),Ot(D,B=>G(i,B),()=>o(i)),R(()=>St(D,"viewBox",`0 0 ${w.width} ${w.height}`)),F(q,D)},$$slots:{default:!0}}),n(u),F(s,u),re()}var xa=E("<!> <!> <!>",1),Ra=E('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1);function $a(s,c){ae(c,!1);const r=V(),a=V();let d=J(c,"stats",8,null),l=J(c,"showRevlog",8,!0);z(()=>ee(d()),()=>{var e;G(r,((e=d())==null?void 0:e.memoryState)!=null)}),z(()=>ee(d()),()=>{var e,i;G(a,(i=(e=d())==null?void 0:e.desiredRetention)!=null?i:.9)}),ce(),te();var S=Ra(),$=ve(S);Ye($,()=>({"--gutter-inline":"1rem","--gutter-block":"0.5rem"})),Be($.lastChild,{breakpoint:"md",children:(e,i)=>{var w=Re(),x=ve(w);{var p=u=>{var m=xa(),h=ve(m);fe(h,{children:(C,K)=>{Zt(C,{get stats(){return d()}})},$$slots:{default:!0}});var q=b(h,2);{var v=C=>{fe(C,{children:(K,B)=>{ma(K,{get revlog(){return d().revlog},get fsrsEnabled(){return o(r)}})},$$slots:{default:!0}})};H(q,C=>{l()&&C(v)})}var D=b(q,2);{var j=C=>{fe(C,{children:(K,B)=>{wa(K,{get revlog(){return d().revlog},get desiredRetention(){return o(a)}})},$$slots:{default:!0}})};H(D,C=>{o(r)&&C(j)})}F(u,m)},t=u=>{Vt(u,{})};H(x,u=>{d()?u(p):u(t,!1)})}F(e,w)},$$slots:{default:!0}}),n($),F(s,S),re()}function Ua(s,c){ae(c,!1);const r=$e(),a=()=>De(Pe,"$page",r);let d=J(c,"data",8);const l=a().url.searchParams.get("revlog")!=="0";globalThis.anki||(globalThis.anki={}),globalThis.anki.updateCard=async S=>{const $=`/card-info/${S}`;return Gt($).catch(()=>{window.location.href=$})},te(),$a(s,{get stats(){return d().info},showRevlog:l}),re()}export{Ua as component,Ga as universal};
