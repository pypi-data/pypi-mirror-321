"use strict";(self.webpackChunklino_react=self.webpackChunklino_react||[]).push([[4580],{3971:(e,t,s)=>{s.r(t),s.d(t,{DashboardItems:()=>p,name:()=>l});s(5247);var a=s(7881),r=s.n(a),o=s(6606),i=(s(1151),s(3748));let n;n={queryString:Promise.all([s.e(4166),s.e(2298)]).then(s.bind(s,9320)),AbortController:s.e(4166).then(s.t.bind(s,1181,23)),whatwgFetch:s.e(4166).then(s.bind(s,9853)),prProgressSpinner:Promise.all([s.e(6190),s.e(5573)]).then(s.bind(s,920)),lm:Promise.resolve().then(s.bind(s,8546)),i18n:Promise.all([s.e(1304),s.e(644),s.e(7211)]).then(s.bind(s,2292))};(0,o.RegisterImportPool)(n);class d extends o.Component{async prepare(){await super.prepare(),this.ex.i18n=this.ex.i18n.default}constructor(){super(),this.liveUpdate=e=>this.update(),this.state={...this.state,data:[],loaded:!1,placeholder:"Loading...",actorID:null},this.reloadData=this.reloadData.bind(this),this.reload=this.reloadData,this.update=this.reloadData}onReady(){this.controller=new this.ex.AbortController.default,this.reloadData()}componentWillUnmount(){this.controller.abort(),delete window.App.URLContext.globals.panels[this.state.actorID]}reloadData(){this.setState({loaded:!1});let e={fmt:"json"};window.App.URLContext.actionHandler.defaultParams(e),this.ex.whatwgFetch.fetch(this.props.endpoint+`?${this.ex.queryString.default.stringify(e)}`,{signal:this.controller.signal}).then((e=>200!==e.status?(this.setState({placeholder:this.ex.i18n.t("Something went wrong")}),{status:e.status$}):e.json())).then((e=>{this.props.post_data(e),this.setState({data:e,loaded:!0,everloaded:!0,actorID:e.actorID}),window.App.URLContext.globals.panels[e.actorID]=this})).catch((function(e){"AbortError"===e.name&&console.log("request aborted",e)}))}render(){if(!this.state.ready)return null;const{data:e,loaded:t,placeholder:s,everloaded:a}=this.state,{render:r}=this.props;return a&&!t?(0,i.jsx)(this.ex.lm.LoadingMask,{mask:!0,children:r(e)}):(0,i.jsx)(this.ex.lm.LoadingMask,{mask:!1,children:t||a&&this.props.useEverLoaded?r(e):this.props.hideLoading?(0,i.jsx)("div",{}):(0,i.jsx)(this.ex.prProgressSpinner.ProgressSpinner,{})})}}d.requiredModules=["queryString","AbortController","whatwgFetch","prProgressSpinner","lm","i18n"],d.iPool=n,d.propTypes={endpoint:r().string.isRequired,render:r().func.isRequired,post_data:r().func,hideLoading:r().bool,useEverLoaded:r().bool},d.defaultProps={post_data:e=>e,hideLoading:!1,useEverLoaded:!1};const l="DashboardItems";let h;h={prButton:Promise.all([s.e(1927),s.e(5573),s.e(7236),s.e(4600),s.e(7801)]).then(s.bind(s,6286)),lm:Promise.resolve().then(s.bind(s,8546))};(0,o.RegisterImportPool)(h);class p extends o.Component{constructor(){super(),this.state={...this.state,stamp:Date(),unloaded:!0},this.reloadData=this.reload,this.onDataGet=this.onDataGet.bind(this)}reload(){Object.keys(window.App.rps).filter((e=>e.includes("dashboard"))).forEach((e=>{window.App.rps[e].reload()}))}onDataGet(e){this.setState({unloaded:!1})}renderDashboard(e,t){return s=>{if(!s.version_mismatch||"dashboard-0"!==t)return s.html?(0,i.jsxs)("div",{children:[e&&(0,i.jsx)(this.ex.prButton.Button,{icon:"pi pi-refresh",style:{float:"right"},onClick:()=>{let e=window.App.rps[t];e&&e.reload()}}),(0,i.jsx)("div",{dangerouslySetInnerHTML:{__html:s.html}})]}):void 0;window.App.reload()}}render(){if(!this.state.ready)return null;const e=this.state,t=this.props;let s=t.dashboard_items;return void 0===s&&(s=0),(0,i.jsxs)(this.ex.lm.LoadingMask,{mask:e.unloaded,fillHeight:!0,backgroundColor:"",children:[(0,i.jsx)(d,{ref:e=>{window.App.setRpRef(e,"dashboard-main")},endpoint:"api/main_html",useEverLoaded:!0,hideLoading:!0,post_data:this.onDataGet,render:this.renderDashboard(!1,"dashboard-main")},`${t.user}-${e.stamp}`),[...Array(s).keys()].map((s=>(0,i.jsx)(d,{ref:e=>{window.App.setRpRef(e,`dashboard-${s}`)},endpoint:`dashboard/${s}`,post_data:this.onDataGet,hideLoading:!0,render:this.renderDashboard(!0,`dashboard-${s}`)},`${t.user}-${s}-${e.stamp}`)))]})}}p.requiredModules=["prButton","lm"],p.iPool=h,p.propTypes={user:r().string},p.defaultProps={P:0}}}]);
//# sourceMappingURL=main.DashboardItems_SiteContext.eb3655a7c24eca38f375.js.map